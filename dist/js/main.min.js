// Begin Me - Talk
window.MeTalkSetup = {
  domain: "comkc.pulscen.ru"
};

(function (d, w, m) {
  window.supportAPIMethod = m;
  var s = d.createElement("script");
  s.type = "text/javascript";
  s.id = "supportScript";
  s.charset = "utf-8";
  s.async = true;
  var id = "9e71060b780fc267cbbfff6f8dec56ba";
  s.src = "//me-talk.ru/support/support.js?h=" + id;
  var sc = d.getElementsByTagName("script")[0];

  w[m] = w[m] || function () {
    (w[m].q = w[m].q || []).push(arguments);
  };

  if (sc) sc.parentNode.insertBefore(s, sc);else d.documentElement.firstChild.appendChild(s);
})(document, window, "MeTalk"); // End Me - Talk
let _mainContent = document.querySelector('.js-body');

let _modalContent = document.querySelectorAll('.modal-wrapper-block');

let _modalClose = document.querySelectorAll('.modal-close');

_mainContent.addEventListener('click', e => {
  let attr_Rel = e.target.getAttribute('rel'); //находим аттрибут попапа который открыли

  let attr_Rel_child = e.target.parentNode.getAttribute('rel'); //находим аттрибут попапа который открыли

  if (attr_Rel != null) {
    modal(attr_Rel);
  } else {
    modal(attr_Rel_child);
  }
});

function modal(attr) {
  _modalContent.forEach(element => {
    attrPopup = element.getAttribute('data-popup');

    if (attrPopup == attr) {
      // сравниваем с аттрибутами модальных окн, если совпадают то
      _modalClose[0].style.display = "block";
      console.log(element);
      element.classList.add('modal-block-show'); // показываем модальное окно

      _mainContent.style.overflow = 'hidden'; // отключаем прокрутку страницы
      // функция для закрытия модального окна 

      _modalClose[0].onclick = function () {
        _modalClose[0].style.display = "none";
        element.classList.remove('modal-block-show');
        _mainContent.style.overflow = 'auto'; // включаем прокрутку страницы
      };

      element.addEventListener('click', clickClose_ => {
        if (clickClose_.target.classList.contains('modal-wrapper-block') || clickClose_.target.classList.contains('modal-closeButt')) {
          element.classList.remove('modal-block-show');
          element.children[0].classList.remove('modal-block-height');
          _mainContent.style.overflow = 'auto'; // включаем прокрутку страницы
        }
      }); // функция для закрытия модального окна через Esc

      document.addEventListener('keydown', keyClose => {
        if (keyClose.keyCode == '27') {
          _modalClose[0].style.display = "none";
          element.classList.remove('modal-block-show');
          _mainContent.style.overflow = 'auto'; // включаем прокрутку страницы
        }
      }); //получаем высоту экрана (рабочей области)

      let height = document.documentElement.clientHeight; //получаем высоту элемента

      let heightEl = element.children[0].clientHeight;

      if (heightEl > height) {
        element.children[0].classList.add('modal-block-height');
        element.style.overflow = 'auto';
      }
    }
  });
}
// Hover Tariff
(function () {
  const tariffLinks = document.querySelectorAll(".promo__tariff-link");
  tariffLinks.forEach(item => {
    const silverTariff = document.querySelector('.silver-tariff'),
          goldTariff = document.querySelector('.gold-tariff'),
          platinumTariff = document.querySelector('.platinum-tariff');
    item.addEventListener('mouseenter', () => {
      if (item.classList.contains('silver-btn')) {
        showTariffInfo(silverTariff);
      } else if (item.classList.contains('gold-btn')) {
        showTariffInfo(goldTariff);
      } else {
        showTariffInfo(platinumTariff);
      }
    });
    item.addEventListener("mouseleave", () => {
      if (item.classList.contains('silver-btn')) {
        hideTariffInfo(silverTariff);
      } else if (item.classList.contains('gold-btn')) {
        hideTariffInfo(goldTariff);
      } else {
        hideTariffInfo(platinumTariff);
      }
    });
  });

  function showTariffInfo(tariff) {
    tariff.classList.remove('hide');
  }

  function hideTariffInfo(tariff) {
    tariff.classList.add('hide');
  }
})();
// Плавный scroll
const anchors = document.querySelectorAll('a[href*="#"]');

for (let anchor of anchors) {
  anchor.addEventListener("click", function (e) {
    e.preventDefault();
    const blockID = anchor.getAttribute("href").substring(1);

    if (blockID) {
      document.getElementById(blockID).scrollIntoView({
        behavior: "smooth",
        block: "start"
      });
    } else {
      return false;
    }
  });
}